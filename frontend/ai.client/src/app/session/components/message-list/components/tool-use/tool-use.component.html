<!-- Gradient border wrapper -->
<!-- [class.gradient-border-loading]="toolUse().status === 'loading'"
[class.gradient-border-success]="toolUse().status === 'success'"
[class.gradient-border-error]="toolUse().status === 'error'" -->
<div class="gradient-border rounded-xl">

  <div class="card-content rounded-xl bg-neutral-50 dark:bg-neutral-800">
    <div class="px-4 py-3">
      <!-- Header row -->
      <div class="flex items-center gap-3">
        <!-- Status icon -->
        <div class="size-4 flex items-center justify-center shrink-0">
          @switch (toolStatus()) {
            @case ('pending') {
              <svg
                class="size-4 text-blue-600 dark:text-blue-400 animate-spin"
                fill="none"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="3"
                />
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                />
              </svg>
            }
            @case ('complete') {
              <svg
                class="size-4 text-green-600 dark:text-green-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2.5"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            }
            @case ('error') {
              <svg
                class="size-4 text-red-600 dark:text-red-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2.5"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            }
          }
        </div>

        <!-- Tool name -->
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-sm/6 font-medium text-neutral-800 dark:text-white">
              {{ toolName() }}
            </span>
          </div>
        </div>

        <!-- Status text -->
        <span
          class="text-xs/6 font-medium"
          [class]="statusIconColor()"
        >
          {{ statusText() }}
        </span>
      </div>

      <!-- Collapsible input section -->
      <div class="mt-2">
        <button
          type="button"
          class="input-toggle flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors"
          [attr.aria-expanded]="isExpanded()"
          (click)="toggleExpanded()"
        >
          <svg
            class="chevron size-3.5"
            [class.open]="isExpanded()"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
          <span>Input</span>
          <code class="font-mono text-neutral-400 dark:text-neutral-500">
            {{ inputKeysPreview() }}
          </code>
        </button>

        <!-- Collapsible content -->
        <div class="collapsible-content" [class.open]="isExpanded()">
          <div>
            <pre
              class="mt-2 p-3 bg-neutral-200/70 dark:bg-neutral-700 rounded-lg font-mono text-xs overflow-x-auto"
            ><code [innerHTML]="formattedJson() | jsonSyntaxHighlight"></code></pre>
          </div>
        </div>
      </div>

      <!-- Result section (only shown if result exists) -->
      @if (hasResult()) {
        <div class="mt-3 pt-3 border-t border-neutral-200 dark:border-neutral-700">
          <button
            type="button"
            class="input-toggle flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors"
            [attr.aria-expanded]="isResultExpanded()"
            (click)="toggleResultExpanded()"
          >
            <svg
              class="chevron size-3.5"
              [class.open]="isResultExpanded()"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
            <span class="font-medium">Result</span>
            @if (toolResult()?.status === 'error') {
              <span class="text-red-600 dark:text-red-400">(Error)</span>
            }
          </button>

          <!-- Collapsible result content -->
          <div class="collapsible-content" [class.open]="isResultExpanded()">
            <div class="mt-2 space-y-2">
              <!-- Text/JSON content -->
              @for (item of resultTextContent(); track $index) {
                <div class="p-3 bg-neutral-200/70 dark:bg-neutral-700 rounded-lg">
                  @if (item.json) {
                    <pre class="font-mono text-xs overflow-x-auto"><code [innerHTML]="formatResultContent(item) | jsonSyntaxHighlight"></code></pre>
                  } @else {
                    <div class="text-sm/6 text-neutral-800 dark:text-neutral-200 whitespace-pre-wrap">{{ formatResultContent(item) }}</div>
                  }
                </div>
              }

              <!-- Image content -->
              @for (item of resultImageContent(); track $index) {
                <div class="rounded-lg overflow-hidden bg-neutral-200/70 dark:bg-neutral-700 p-2">
                  <img
                    [src]="getImageDataUrl(item)"
                    alt="Tool result image"
                    class="max-w-full h-auto rounded-sm"
                  />
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>
