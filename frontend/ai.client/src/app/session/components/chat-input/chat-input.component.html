<div 
    class="relative rounded-2xl shadow-xl outline -outline-offset-1 transition-all duration-200"
    [class]="isFocused() 
      ? 'bg-white dark:bg-slate-800 outline-2 outline-primary-500 dark:outline-primary-500 ring-2 ring-primary-500/20 dark:ring-primary-500/30 shadow-lg' 
      : 'bg-gray-50 dark:bg-slate-800 outline-1 outline-gray-300 dark:outline-white/10'"
  >
    <!-- Main Input Area -->
    <div class="relative">
      <label for="user-message" class="sr-only">How can I help you today?</label>
      <textarea
        id="user-message"
        name="user-message"
        rows="1"
        [value]="userInput()"
        (input)="onTextareaInput($event)"
        (keydown)="onKeyDown($event)"
        (focus)="onFocus()"
        (blur)="onBlur()"
        placeholder="How can I help you today?"
        class="block w-full resize-none bg-transparent px-6 py-4 text-base text-gray-900 placeholder:text-gray-500 dark:text-gray-100 dark:placeholder:text-gray-400 focus:outline-hidden overflow-hidden"
        style="min-height: 60px; max-height: 200px;"
      ></textarea>

      <!-- Bottom Controls Bar -->
      <div class="flex items-center justify-between px-4 pb-3">
        <!-- Left Controls -->
        <div class="flex items-center gap-2">
          <!-- Add Attachment Button -->
          <button
            type="button"
            class="flex size-10 items-center justify-center rounded-lg text-gray-500 dark:text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-700 dark:hover:bg-white/5 dark:hover:text-gray-300 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-primary)]"
            aria-label="Attach a file"
          >
            <input
              type="file"
              class="sr-only"
              (change)="onFileSelect($event)"
              id="file-upload"
            />
            <label for="file-upload" class="flex size-full cursor-pointer items-center justify-center">
              <ng-icon name="heroPlus" class="size-5" />
            </label>
          </button>

          <!-- Settings Button -->
          <button
            type="button"
            class="flex size-10 items-center justify-center rounded-lg text-gray-500 dark:text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-700 dark:hover:bg-white/5 dark:hover:text-gray-300 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-primary)]"
            aria-label="Settings"
          >
            <ng-icon name="heroAdjustmentsHorizontal" class="size-5" />
          </button>

          <!-- History Button -->
          <button
            type="button"
            class="flex size-10 items-center justify-center rounded-lg text-gray-500 dark:text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-700 dark:hover:bg-white/5 dark:hover:text-gray-300 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-primary)]"
            aria-label="History"
          >
            <ng-icon name="heroClock" class="size-5" />
          </button>
        </div>

        <!-- Right Controls -->
        <div class="flex items-center gap-3">
          <!-- Model Selector -->
          <app-model-dropdown />

          <!-- Submit/Stop Button -->
          <button
            type="button"
            (click)="onSubmit()"
            [class]="chatState.isChatLoading()
              ? 'flex size-10 items-center justify-center rounded-full bg-red-500 text-white shadow-sm transition-all hover:bg-red-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500'
              : 'flex size-10 items-center justify-center rounded-full bg-secondary-500 text-white shadow-sm transition-all hover:bg-secondary-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary-500 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-secondary-500'"
            [attr.aria-label]="chatState.isChatLoading() ? 'Stop generation' : 'Submit message'"
          >
            @if (chatState.isChatLoading()) {
              <!-- Stop Icon -->
              <ng-icon name="heroStop" class="size-5" />
            } @else {
              <!-- Send Icon -->
              <ng-icon name="heroPaperAirplane" class="size-5" />
            }
          </button>
        </div>
      </div>
    </div>
  </div>