<!-- Mobile sidenav overlay -->
@if (sidenavService.isVisible()) {
  <div class="relative z-50 lg:hidden" role="dialog" aria-modal="true">
    <!-- Backdrop -->
    <div
      [class]="sidenavService.isOpen() ? 'sidenav-backdrop-enter' : 'sidenav-backdrop-exit'"
      class="fixed inset-0 bg-gray-900/80"
      (click)="sidenavService.close()"
      aria-hidden="true">
    </div>

    <div class="fixed inset-0 flex">
      <!-- Sidenav panel -->
      <div
        [class]="sidenavService.isOpen() ? 'sidenav-panel-enter' : 'sidenav-panel-exit'"
        class="relative mr-16 flex w-full max-w-xs flex-1">
        <!-- Close button -->
        <div class="absolute left-full top-0 flex w-16 justify-center pt-5">
          <button type="button" (click)="sidenavService.close()" class="-m-2.5 p-2.5">
            <span class="sr-only">Close sidebar</span>
            <svg class="size-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <app-sidenav></app-sidenav>
      </div>
    </div>
  </div>
}

<!-- Static sidebar for desktop -->
<div
  class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex size-auto transition-transform duration-300"
  [class.-translate-x-full]="sidenavService.isCollapsed()">
  <!-- Sidenav component -->
  <app-sidenav></app-sidenav>
</div>

<!-- Desktop controls (when sidenav collapsed) -->
@if (sidenavService.isCollapsed()) {
  <div class="hidden lg:flex fixed top-4 left-4 z-50 gap-2">
    <!-- Expand sidebar button -->
    <button
      type="button"
      [appTooltip]="'Expand sidebar'"
      appTooltipPosition="right"
      (click)="sidenavService.expand()"
      class="flex items-center justify-center size-10 rounded-md bg-gray-100 text-gray-500 shadow-xs hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
      aria-label="Expand sidebar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-6" aria-hidden="true">
        <rect x="3" y="4" width="18" height="16" rx="2" ry="2" />
        <line x1="9" y1="4" x2="9" y2="20" />
      </svg>
    </button>
    <!-- New chat button -->
    <button
      type="button"
      [appTooltip]="'New chat'"
      appTooltipPosition="right"
      (click)="newChat()"
      class="flex items-center justify-center size-10 rounded-full bg-secondary-500 text-white shadow-xs hover:bg-secondary-400"
      aria-label="New chat">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="size-5" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
    </button>
  </div>
}

<!-- Mobile controls (when header content hidden and sidenav not visible) -->
@if (!headerService.showContent() && !sidenavService.isVisible()) {
  <div class="flex lg:hidden fixed top-4 left-4 z-50 gap-2">
    <!-- Open sidenav button -->
    <button
      type="button"
      [appTooltip]="'Open sidebar'"
      appTooltipPosition="right"
      (click)="sidenavService.open()"
      class="flex items-center justify-center size-10 rounded-md bg-gray-100 text-gray-500 shadow-xs hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
      aria-label="Open sidebar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-6" aria-hidden="true">
        <rect x="3" y="4" width="18" height="16" rx="2" ry="2" />
        <line x1="9" y1="4" x2="9" y2="20" />
      </svg>
    </button>
    <!-- New chat button -->
    <button
      type="button"
      [appTooltip]="'New chat'"
      appTooltipPosition="right"
      (click)="newChat()"
      class="flex items-center justify-center size-10 rounded-full bg-secondary-500 text-white shadow-xs hover:bg-secondary-400"
      aria-label="New chat">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="size-5" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
    </button>
  </div>
}

<div
  class="transition-[padding] duration-300"
  [class.lg:pl-72]="!sidenavService.isCollapsed()"
  [class.lg:pl-0]="sidenavService.isCollapsed()">
  <main class="flex flex-col">
    <!-- Scrollable Content -->
    <div class="flex-1 overflow-y-auto">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
        <router-outlet />
      </div>
    </div>
  </main>
</div>

<!-- Global error toast notifications -->
<app-error-toast />

<!-- Global toast notifications -->
<app-toast />